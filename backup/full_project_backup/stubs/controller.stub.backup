    /**
     * Export to Excel
     */
    protected function exportToExcel($data)
    {
        $spreadsheet = new Spreadsheet();
        $sheet = $spreadsheet->getActiveSheet();
        
        // Set Right-to-Left for Arabic support if the app locale is Arabic
        if (App::getLocale() == 'ar') {
            $sheet->setRightToLeft(true);
        }

        // Set the title
        $sheet->setTitle(__('{{viewPath}}.title'));
        $sheet->setCellValue('A1', __('{{viewPath}}.title'));
        $sheet->mergeCells('A1:E1');
        $sheet->getStyle('A1')->getFont()->setBold(true)->setSize(16);
        $sheet->getStyle('A1')->getAlignment()->setHorizontal(\PhpOffice\PhpSpreadsheet\Style\Alignment::HORIZONTAL_CENTER);

        // Prepare headers
        $headers = [];
        if ($data->count() > 0) {
            $firstItem = $data->first();
            foreach ($firstItem->getAttributes() as $key => $value) {
                if (!in_array($key, ['id', 'created_at', 'updated_at', 'deleted_at'])) {
                    $headers[] = __('{{viewPath}}.fields.' . $key);
                }
            }
        }

        // Add headers to sheet
        $col = 'A';
        foreach ($headers as $header) {
            $sheet->setCellValue($col . '3', $header);
            $col++;
        }
        
        // Style header row
        $headerRange = 'A3:' . chr(ord('A') + count($headers) - 1) . '3';
        $sheet->getStyle($headerRange)->getFont()->setBold(true)
            ->setFillType(\PhpOffice\PhpSpreadsheet\Style\Fill::FILL_SOLID)
            ->getStartColor()->setARGB('FFEEEEEE');

        // Add data rows
        $row = 4;
        foreach ($data as $item) {
            $col = 'A';
            foreach ($item->getAttributes() as $key => $value) {
                if (!in_array($key, ['id', 'created_at', 'updated_at', 'deleted_at'])) {
                    if (is_a($value, 'Carbon\Carbon')) {
                        $sheet->setCellValue($col . $row, $value->format('Y-m-d H:i:s'));
                    } else {
                        $sheet->setCellValue($col . $row, $value);
                    }
                    $col++;
                }
            }
            $row++;
        }

        // Auto size columns
        foreach(range('A','Z') as $columnID) {
            $sheet->getColumnDimension($columnID)->setAutoSize(true);
        }

        $writer = new Xlsx($spreadsheet);
        $fileName = '{{modelName}}_export_' . date('Y-m-d_H-i-s') . '.xlsx';

        return response()->streamDownload(function() use ($writer) {
            $writer->save('php://output');
        }, $fileName);
    }
    
    /**
     * Export Trial Balance to PDF
     */
    public function exportTrialBalance($startDate = null, $endDate = null)
    {
        $trialBalance = $this->generateTrialBalance($startDate, $endDate);
        
        $pdf = Pdf::loadView('pages.{{viewPath}}.trial-balance', [
            'trialBalance' => $trialBalance,
            'startDate' => $startDate,
            'endDate' => $endDate
        ]);
        
        return $pdf->download(__('global.trial_balance') . '_' . date('Y-m-d_H-i-s') . '.pdf');
    }
    
    /**
     * Export Account Statement to PDF
     */
    public function exportAccountStatement($startDate = null, $endDate = null)
    {
        $accountStatement = $this->generateAccountStatement($startDate, $endDate);
        
        $pdf = Pdf::loadView('pages.{{viewPath}}.account-statement', [
            'accountStatement' => $accountStatement,
            'startDate' => $startDate,
            'endDate' => $endDate
        ]);
        
        return $pdf->download(__('global.account_statement') . '_' . date('Y-m-d_H-i-s') . '.pdf');
    }
    
    /**
     * Export Trial Balance to Excel
     */
    protected function exportTrialBalanceExcel($startDate = null, $endDate = null)
    {
        $trialBalance = $this->generateTrialBalance($startDate, $endDate);
        
        $spreadsheet = new Spreadsheet();
        $sheet = $spreadsheet->getActiveSheet();
        
        // Set Right-to-Left for Arabic support if the app locale is Arabic
        if (App::getLocale() == 'ar') {
            $sheet->setRightToLeft(true);
        }

        $sheet->setTitle(__('global.trial_balance'));
        $sheet->setCellValue('A1', __('global.trial_balance'));
        $sheet->mergeCells('A1:E1');
        $sheet->getStyle('A1')->getFont()->setBold(true)->setSize(16);
        $sheet->getStyle('A1')->getAlignment()->setHorizontal(\PhpOffice\PhpSpreadsheet\Style\Alignment::HORIZONTAL_CENTER);

        // Add date range if provided
        if ($startDate || $endDate) {
            $dateRange = '';
            if ($startDate) {
                $dateRange .= __('global.start_date') . ': ' . $startDate;
            }
            if ($endDate) {
                $dateRange .= ($dateRange ? ' | ' : '') . __('global.end_date') . ': ' . $endDate;
            }
            $sheet->setCellValue('A2', $dateRange);
        }

        $headers = [__('global.account_name'), __('global.debits'), __('global.credits'), __('global.balance'), __('global.type')];
        $sheet->fromArray($headers, NULL, 'A3');
        $sheet->getStyle('A3:E3')->getFont()->setBold(true)->setFillType(\PhpOffice\PhpSpreadsheet\Style\Fill::FILL_SOLID)->getStartColor()->setARGB('FFEEEEEE');

        $row = 4;
        foreach ($trialBalance['entries'] as $entry) {
            $sheet->setCellValue('A' . $row, $entry['account_name']);
            $sheet->setCellValue('B' . $row, $entry['debits']);
            $sheet->setCellValue('C' . $row, $entry['credits']);
            $sheet->setCellValue('D' . $row, $entry['balance']);
            $sheet->setCellValue('E' . $row, __('global.' . $entry['type'])); // Translate type
            $row++;
        }

        // Totals
        $sheet->setCellValue('A' . $row, __('global.total'));
        $sheet->setCellValue('B' . $row, $trialBalance['totals']['total_debits']);
        $sheet->setCellValue('C' . $row, $trialBalance['totals']['total_credits']);
        $sheet->setCellValue('D' . $row, $trialBalance['totals']['difference']);
        $sheet->getStyle('A' . $row . ':E' . $row)->getFont()->setBold(true)->getBorders()->getTop()->setBorderStyle(\PhpOffice\PhpSpreadsheet\Style\Border::BORDER_THIN);

        $writer = new Xlsx($spreadsheet);
        $fileName = __('global.trial_balance') . '_' . date('Y-m-d_H-i-s') . '.xlsx';

        return response()->streamDownload(function() use ($writer) {
            $writer->save('php://output');
        }, $fileName);
    }
    
    /**
     * Export Account Statement to Excel
     */
    protected function exportAccountStatementExcel($startDate = null, $endDate = null)
    {
        $accountStatement = $this->generateAccountStatement($startDate, $endDate);
        
        $spreadsheet = new Spreadsheet();
        $sheet = $spreadsheet->getActiveSheet();
        
        // Set Right-to-Left for Arabic support if the app locale is Arabic
        if (App::getLocale() == 'ar') {
            $sheet->setRightToLeft(true);
        }

        $sheet->setTitle(__('global.account_statement'));
        $sheet->setCellValue('A1', __('global.account_statement') . ' - ' . $accountStatement['account_name']);
        $sheet->mergeCells('A1:E1');
        $sheet->getStyle('A1')->getFont()->setBold(true)->setSize(16);
        $sheet->getStyle('A1')->getAlignment()->setHorizontal(\PhpOffice\PhpSpreadsheet\Style\Alignment::HORIZONTAL_CENTER);

        // Add date range if provided
        if ($startDate || $endDate) {
            $dateRange = '';
            if ($startDate) {
                $dateRange .= __('global.start_date') . ': ' . $startDate;
            }
            if ($endDate) {
                $dateRange .= ($dateRange ? ' | ' : '') . __('global.end_date') . ': ' . $endDate;
            }
            $sheet->setCellValue('A2', $dateRange);
        }

        $headers = [__('global.date'), __('global.description'), __('global.debit'), __('global.credit'), __('global.balance')];
        $sheet->fromArray($headers, NULL, 'A3');
        $sheet->getStyle('A3:E3')->getFont()->setBold(true)->setFillType(\PhpOffice\PhpSpreadsheet\Style\Fill::FILL_SOLID)->getStartColor()->setARGB('FFEEEEEE');

        $row = 4;
        foreach ($accountStatement['entries'] as $entry) {
             $sheet->setCellValue('A' . $row, $entry['date']->format('Y-m-d'));
             $sheet->setCellValue('B' . $row, $entry['description']);
             $sheet->setCellValue('C' . $row, $entry['debit']);
             $sheet->setCellValue('D' . $row, $entry['credit']);
             $sheet->setCellValue('E' . $row, $entry['balance']);
             $row++;
        }

         $sheet->setCellValue('A' . $row, __('global.final_balance'));
         $sheet->setCellValue('E' . $row, $accountStatement['final_balance']);
         $sheet->getStyle('A' . $row . ':E' . $row)->getFont()->setBold(true)->getBorders()->getTop()->setBorderStyle(\PhpOffice\PhpSpreadsheet\Style\Border::BORDER_THIN);

        $writer = new Xlsx($spreadsheet);
        $fileName = __('global.account_statement') . '_' . date('Y-m-d_H-i-s') . '.xlsx';

        return response()->streamDownload(function() use ($writer) {
            $writer->save('php://output');
        }, $fileName);
    }